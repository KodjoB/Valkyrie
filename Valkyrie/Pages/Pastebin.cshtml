@page
@model Valkyrie.Pages.PastbinModel

<div class="card" style="width:auto">
    <div class="card-body">
        <h5 class="card-title">Pastebin Dump</h5>
        <h6 class="card-subtitle mb-2 text-muted">(Site: https://twitter.com, Rate Limit: https://developer.twitter.com/en/docs/twitter-api/rate-limits)</h6>
        <p class="card-text">Keep an eye on latest tweets that contain hashtags/keywords (space separated) (minitor up to 5 keywords). Chart might be incomplete due to Twitter ratelimit.</p>
        <div class="input-group mb-3">
            @Html.AntiForgeryToken()
            <input type="text" class="form-control" id="UserInput" placeholder="Enter #hash1 keyword #hash2;...
" aria-label="Recipient's username" aria-describedby="basic-addon2">
            <div class="input-group-append">
                <button class="btn btn-success" type="button" id="btnSend">Submit</button>
            </div>

        </div>
    </div>
</div>
<table id="customerDatatable" class="table table-sm table-dark" width="100%" cellspacing="0">
    <thead>
        <tr>
            <th>Keyword</th>
            <th>Time</th>
            <th>Tags</th>
            <th>Text</th>
            <th>Id</th>
        </tr>
    </thead>
</table>
<div><canvas id="lineChart"></canvas></div>
<div class="d-flex justify-content-center" id="loader">
    <div class="spinner-border text-warning" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<script src="~/lib/datatables/js/jquery.dataTables.min.js"></script>
<script src="~/lib/datatables/js/dataTables.bootstrap4.min.js"></script>
<script src="~/lib/Chart.js/Chart.js"></script>
<script type="text/javascript">
    $("#loader").attr('style', 'display:none!important');
    $('#btnSend').on('click', function () {
        $("#loader").attr('style', 'display:flex');
        var UserInput = $('#UserInput').val();
        var t = $('#customerDatatable').DataTable();
        t.order([0, "asc"], [1, "desc"]);
      
        t.clear().draw();
        $.ajax({
            type: "POST",
            url: "/Pastebin",
            beforeSend: function (xhr) {
                xhr.setRequestHeader("TryHarder",
                    $('input:hidden[name="__RequestVerificationToken"]').val());
            },
            data: { UserInput: UserInput },
            success: function (response) {
                eval(response.chart);
 
                $.each(response.table, function (key, value) {
                    console.log(value);
                    var j = JSON.parse(value);
                    $.each(j.data, function (k, v) {
                        t.row.add([j.search, v.time, v.tags,v.text, v.id]).draw(true);
                    });

                });
                $("#loader").attr('style', 'display:none!important');
            },
        });
    })
</script>